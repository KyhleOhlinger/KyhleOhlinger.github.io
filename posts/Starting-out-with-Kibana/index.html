<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Starting out with Kibana and ElasticSearch-DSL" /><meta name="author" content="Kyhle Öhlinger" /><meta property="og:locale" content="en" /><meta name="description" content="Hi all, My name is Kyhle Öhlinger and this blog post forms part of my personal blog. If you enjoy any of the posts, feel free to reach out and let me know :)" /><meta property="og:description" content="Hi all, My name is Kyhle Öhlinger and this blog post forms part of my personal blog. If you enjoy any of the posts, feel free to reach out and let me know :)" /><link rel="canonical" href="https://ohlinger.co/posts/Starting-out-with-Kibana/" /><meta property="og:url" content="https://ohlinger.co/posts/Starting-out-with-Kibana/" /><meta property="og:site_name" content="Kyhle Öhlinger" /><meta property="og:image" content="https://ohlinger.co/assets/img/elkstack.jpg" /><meta property="og:image:height" content="500" /><meta property="og:image:width" content="800" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-05-13T06:00:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://ohlinger.co/assets/img/elkstack.jpg" /><meta property="twitter:title" content="Starting out with Kibana and ElasticSearch-DSL" /><meta name="twitter:site" content="@KyhleO" /><meta name="twitter:creator" content="@KyhleO" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kyhle Öhlinger","url":"https://github.com/KyhleOhlinger/"},"dateModified":"2025-02-07T16:20:24-05:00","datePublished":"2020-05-13T06:00:00-04:00","description":"Hi all, My name is Kyhle Öhlinger and this blog post forms part of my personal blog. If you enjoy any of the posts, feel free to reach out and let me know :)","headline":"Starting out with Kibana and ElasticSearch-DSL","image":{"width":800,"height":500,"url":"https://ohlinger.co/assets/img/elkstack.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ohlinger.co/posts/Starting-out-with-Kibana/"},"url":"https://ohlinger.co/posts/Starting-out-with-Kibana/"}</script><title>Starting out with Kibana and ElasticSearch-DSL | Kyhle Öhlinger</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kyhle Öhlinger"><meta name="application-name" content="Kyhle Öhlinger"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/Kyhle_Icon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kyhle Öhlinger</a></div><div class="site-subtitle font-italic">Lead Security Engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/KyhleOhlinger" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/KyhleO" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['kyhle','ohlinger.co'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/kyhleohlinger" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Starting out with Kibana and ElasticSearch-DSL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Starting out with Kibana and ElasticSearch-DSL</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1589364000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 13, 2020 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/elkstack.jpg" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/KyhleOhlinger/">Kyhle Öhlinger</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1442 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>Over the course of the past few weeks, I have been looking into <a href="https://splunk.com">Splunk</a> and <a href="https://www.elastic.co/kibana">Kibana</a>. This post isn’t a comparison of the two, but there are several <a href="https://devops.com/splunk-elk-stack-side-side-comparison/">posts</a> covering this topic. Splunk is a great alternative and has a host of features that are unfortunately missing from Kibana. There is a really nice <a href="https://www.splunk.com/en_us/training/free-courses/splunk-fundamentals-1.html">Free Fundamentals Course</a> offered by Splunk if you are interested in learning about it and how it works.</p><p>Based on cost and the work that I am currently looking into, I decided to focus my efforts on Kibana. The goal of this post is to provide you with a Python ElasticSearch-DSL template script that you can use when querying Kibana.</p><p>This post will cover the following:</p><ul><li>What is ELK?<li>Running Python in Windows<li>Connecting to an installed instance of Kibana<li>Simple Python ElasticSearch Script<li>Some useful resources to help you along the way</ul><p>If you are not interested in the theory and the Windows Setup, you can skip towards the end where the <a href="#creating-your-first-python-script">script</a> is.</p><h2 id="what-is-elk"><span class="mr-2">What is Elk?</span><a href="#what-is-elk" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>ELK stands for Elasticsearch, Logstash, and Kibana, although it is often just referred to as Elasticsearch:</p><ul><li>Elasticsearch – a NoSQL database which uses Lucene search engine (log searching).<li>Logstash – It is a pipeline used to populate Elasticsearch with data (data router and data processing).<li>Kibana – It is a dashboard working on top of Elasticsearch which can be used for data analysis (data visualisation).</ul><p>The combination of the 3 technologies is called ELK stack. If you want to interact with it on a more visual basis, Kibana makes use of a query language called Lucene query syntax which replaced Kibana’s legacy query language. I don’t want to bore you with the details surrounding ELK, so I’m just going to cover the following two areas that I feel are important.</p><ul><li><p><strong>The Discover Tab</strong> in Kibana is where you can perform general queries and inspect the data that is coming in from the logs – if you are using the full ELK stack, then the agent will be the Logstash agent that you have set up.</p><li><p><strong>The Visualisation Tab</strong> is where you will be able to fine grain your queries through the use of Buckets and Metrics. Visualisations in Kibana are very powerful as they allow you to group data elements together and output them in a format that suits you, whether this is in the form of a table or charts related to the data that you are accessing.</p></ul><h2 id="running-python-in-windows"><span class="mr-2">Running Python in Windows</span><a href="#running-python-in-windows" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Depending on the Operating System (OS) you are running, you will need to install Python. Because I wanted to try something new, I decided to set Python up in a Windows VM – This post will cover the process involved, as well as how to get your Python instance up and running to query Kibana data through Elasticsearch. We need to start by installing Python. Navigate to <a href="https://www.python.org/downloads/windows/">Python Downloads</a> and download a version from the latest Stable Releases. When installing the software, unless you want to add it to your path yourself, I would recommend ticking the “Add Python 3.8 to PATH” shown below, which takes care of it for you.</p><p class="imgMiddle"> <img data-src="/assets/img/Kibana/python.png" style="width: 45%" data-proofer-ignore></p><p>Once installation has completed, you should be able to run Python from the command line by typing <code class="language-plaintext highlighter-rouge">python</code> as shown below:</p><p class="imgMiddle"> <img data-src="/assets/img/Kibana/pythoncmd.png" style="width: 60%" data-proofer-ignore></p><p>From this point on, it is assumed that you have an instance of Kibana that you are able to connect to in order to retrieve data. In order to get the Python elasticsearch-dsl up and running, you will need to install some Pip modules first. I’m not sure if all of these are relevant for your instance - but these are the modules that I’ve needed while playing around with ELK:</p><ul><li>wheel<li>elasticsearch_dsl<li>elasticsearch<li>elasticsearch5<li>pytz<li>jira<li>datetime<li>requests<li>argparse</ul><p>You can add them to a text file and use <code class="language-plaintext highlighter-rouge">pip3 install -r requirements.txt</code> in command line. <strong>Note</strong> - if you are using a system proxy like I was, you either need to turn the proxy off, or add it using the –proxy flag to prevent the connection to pypi from timing out.</p><p>Before we begin with the python script, you should run following curl command: <code class="language-plaintext highlighter-rouge">curl -XGET localhost:9200</code> to determine whether you are able to connect to your Kibana instance from command line if you are hosting it locally, otherwise replace localhost with the relevant URL. This step will be essential to ensure that you will be able to connect your Python script to the instance. The output should include information similar to below:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"kibana-instance.cluster"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cluster_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"my-cluster"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cluster_uuid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Some UUID"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"5.6.10"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_hash"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"b727a60"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-06T15:48:34.860Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_snapshot"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lucene_version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"6.6.1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"tagline"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"You Know, for Search"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h2 id="creating-your-first-python-script"><span class="mr-2">Creating your first Python Script:</span><a href="#creating-your-first-python-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that everything is set up, we can start working on the script which uses elasticsearch-dsl. Elasticsearch-dsl is a high-level library that leverages the power of ElasticSearch and Python to create queries, buckets, and metrics in a simple manner. It is similar to using the Visualisation Tab in the Kibana frontend. When trying to create a python query, you should first ensure that it is possible to retrieve the data from the Kibana frontend. Your Kibana query might look something like this:</p><p><a href="https://localhost/app/kibana#/discover?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now%2FM,mode:quick,to:now%2FM))&amp;_a=(columns:!(Some_Field),index:AWrZ2ZggnSNtdcvkyo2c,interval:auto,query:(query_string:(query:'*')),sort:!(inserted,desc))">https://localhost/app/kibana#/discover?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now%2FM,mode:quick,to:now%2FM))&amp;_a=(columns:!(Some_Field),index:AWrZ2ZggnSNtdcvkyo2c,interval:auto,query:(query_string:(query:'*')),sort:!(inserted,desc))</a></p><p>The query shown above makes use of a wildcard (*) which allows it to search through all of the data field while filtering by the field, <em>Some_Field</em>. In this basic script, we are going to create a main function which takes in parameters, searches for <em>Some_Field</em> and provides basic output:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">elasticsearch</span>
<span class="kn">from</span> <span class="nn">elasticsearch_dsl</span> <span class="kn">import</span> <span class="n">Search</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">A</span>

<span class="k">def</span> <span class="nf">query_script</span><span class="p">(</span><span class="n">time_period</span><span class="p">):</span>
    <span class="n">es</span> <span class="o">=</span> <span class="n">elasticsearch</span><span class="p">.</span><span class="n">Elasticsearch</span><span class="p">(</span>
        <span class="s">"localhost:9200"</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
    <span class="p">)</span>
    
    <span class="n">basic_query</span> <span class="o">=</span> <span class="n">Search</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="n">es</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">"some_index"</span><span class="p">)</span>

    <span class="c1"># This will change the timerange that you are searching through
</span>    <span class="n">basic_query</span> <span class="o">=</span> <span class="n">basic_query</span><span class="p">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">Q</span><span class="p">(</span><span class="s">'range'</span><span class="p">,</span> <span class="n">inserted</span><span class="o">=</span><span class="p">{</span><span class="s">'gte'</span><span class="p">:</span> <span class="s">'now-'</span> <span class="o">+</span> <span class="n">time_period</span><span class="p">,</span> <span class="s">'lte'</span><span class="p">:</span> <span class="s">'now'</span><span class="p">})</span>
    <span class="p">)</span>

    <span class="c1"># match_all is a wildcard in this instance where you want all the data returned for a specific field
</span>    <span class="n">basic_query</span> <span class="o">=</span> <span class="n">basic_query</span><span class="p">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">Q</span><span class="p">(</span><span class="s">"match_all"</span><span class="p">,</span><span class="n">field</span><span class="o">=</span><span class="s">"Some_Field"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">basic_query_results</span> <span class="o">=</span> <span class="n">basic_query</span><span class="p">.</span><span class="n">execute</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">basic_query_results</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    
     <span class="c1"># Parse arguments - This is optional, can add as many user inputs as you would like
</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
     <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--range"</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"choose to override default date in DAYS e.g. --range 30d"</span><span class="p">)</span>
     <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

     <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="nb">range</span><span class="p">:</span>
          <span class="n">time_period</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nb">range</span>
     <span class="k">else</span><span class="p">:</span>
          <span class="n">time_period</span> <span class="o">=</span> <span class="s">"7d"</span>
          
     <span class="n">basic_query_results</span> <span class="o">=</span> <span class="n">query_script</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
          
    <span class="c1"># Returns the 10 most recent results   
</span>     <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">basic_query_results</span><span class="p">:</span>
         <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Some_Field</span><span class="p">))</span>
</pre></table></code></div></div><p>Remember I mentioned Buckets and Metrics above, you can add those checks into the script as well, however that is out-of-scope for this basic script. You will notice that there are parts of the script that use shorthand notation in order to interact with Elasticsearch. The basic shorthands that you will most likely use are:</p><ul><li>Q() - Query, which is included using the <code class="language-plaintext highlighter-rouge">from elasticsearch_dsl import Q</code> import<li>A() - Aggregation, which is included using the <code class="language-plaintext highlighter-rouge">from elasticsearch_dsl import A</code> import</ul><h3 id="something-extra"><span class="mr-2">Something Extra</span><a href="#something-extra" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>One thing I realised when initially setting up elasticsearch-dsl was that the queries would only return the 10 most recent results, as detailed in this <a href="https://github.com/elastic/elasticsearch-dsl-py/issues/737">Github Post</a>. Now why is this the case? The query can return a lot of data and by limiting it, it won’t overload the server or your ouput. If you want to return all of the results you need to explicitly request it, and the simplest way is to slice from zero to the total number of hits (i.e. search.count()). A quick method to return all results is shown below:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">total</span> <span class="o">=</span> <span class="n">basic_query</span><span class="p">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">search</span> <span class="o">=</span> <span class="n">basic_query</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">total</span><span class="p">]</span>

<span class="n">basic_query_results</span> <span class="o">=</span> <span class="n">search</span><span class="p">.</span><span class="n">execute</span><span class="p">()</span>
<span class="k">return</span> <span class="n">basic_query_results</span>
</pre></table></code></div></div><p>What this does is it counts all of the results which are returned by the query and accesses them in the form of a <code class="language-plaintext highlighter-rouge">list</code>. From there you can decide how many results you require in order to satisfy your use case.</p><p>This blog detailed some of the steps that I needed to take when starting out with ELK stack on Windows. I hope that it helps someone if they are struggling to get the interaction between Python and their deployment working, and that this can help ease some questions or concerns. I have included some very useful links (imo) that I have found while trying to wrap my head around this topic.</p><h2 id="useful-resources"><span class="mr-2">Useful Resources</span><a href="#useful-resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>Kibana:</strong></p><ul><li><a href="https://deep-log-inspection.readthedocs.io/en/latest/user/kibana-logs/">https://deep-log-inspection.readthedocs.io/en/latest/user/kibana-logs/</a></ul><p><strong>Lucene Query Syntax:</strong></p><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-query-string-query.html#query-string-syntax">https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-query-string-query.html#query-string-syntax</a><li><a href="https://lucene.apache.org/core/2_9_4/queryparsersyntax.html">https://lucene.apache.org/core/2_9_4/queryparsersyntax.html</a></ul><p><strong>Elastic Search:</strong></p><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.4/query-dsl.html">https://www.elastic.co/guide/en/elasticsearch/reference/5.4/query-dsl.html</a><li><a href="https://elasticsearch-dsl.readthedocs.io/en/7.2.0/search_dsl.html?highlight=bucket">https://elasticsearch-dsl.readthedocs.io/en/7.2.0/search_dsl.html?highlight=bucket</a><li><a href="https://medium.com/@User3141592/understanding-the-elasticsearch-query-dsl-ce1d67f1aa5b">https://medium.com/@User3141592/understanding-the-elasticsearch-query-dsl-ce1d67f1aa5b</a><li><a href="https://www.tutorialspoint.com/elasticsearch/elasticsearch_quick_guide.htm">https://www.tutorialspoint.com/elasticsearch/elasticsearch_quick_guide.htm</a><li><a href="https://logz.io/blog/elasticsearch-queries/">https://logz.io/blog/elasticsearch-queries/</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/technical/'>Technical</a>, <a href='/categories/detection-engineering/'>Detection Engineering</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Starting+out+with+Kibana+and+ElasticSearch-DSL+-+Kyhle+%C3%96hlinger&url=https%3A%2F%2Fohlinger.co%2Fposts%2FStarting-out-with-Kibana%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Starting+out+with+Kibana+and+ElasticSearch-DSL+-+Kyhle+%C3%96hlinger&u=https%3A%2F%2Fohlinger.co%2Fposts%2FStarting-out-with-Kibana%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fohlinger.co%2Fposts%2FStarting-out-with-Kibana%2F&text=Starting+out+with+Kibana+and+ElasticSearch-DSL+-+Kyhle+%C3%96hlinger" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/creating-a-chrome-extension/">Creating a Chrome Extension to Query Multiple LLMs</a><li><a href="/posts/centralizing-gcp-logging/">Setting up Logging and Billing for GCP Projects using Terraform</a><li><a href="/posts/testing-ai-setups/">High-Level Overview of my Current AI Toolset</a><li><a href="/posts/prompt-engineering-thoughts/">From Curiosity to Creativity&#58; My Thoughts on Prompt Engineering</a><li><a href="/posts/withsecure-myllmdoc-challenge/">WithSecure AI Challenge - My LLM Doctor</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div class="post-navigation d-flex justify-content-between"> <a href="/posts/working-as-a-pentester/" class="btn btn-outline-primary" prompt="Older"><p>Working as a Pentester</p></a> <a href="/posts/art-and-science/" class="btn btn-outline-primary" prompt="Newer"><p>Art and Science</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/KyhleO">Kyhle Öhlinger</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
